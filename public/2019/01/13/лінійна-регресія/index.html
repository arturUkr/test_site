<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.53" />


<title>Лінійна регресія - A Hugo website</title>
<meta property="og:title" content="Лінійна регресія - A Hugo website">



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/rstudio/blogdown">GitHub</a></li>
    
    <li><a href="https://twitter.com/rstudio">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">24 min read</span>
    

    <h1 class="article-title">Лінійна регресія</h1>

    
    <span class="article-date">2019/01/13</span>
    

    <div class="article-content">
      


<div id="--" class="section level2">
<h2>Всякі різні викладки</h2>
<p>Лінійна регресія - метод відновлення залежності між цільовою змінною та іншими змінними. Лінійна означає, що цільова змінна виражається через рівняння наступного вигляду <span class="math inline">\(y = ax + b + e = \hat{y} + e\)</span>, де <span class="math inline">\(e\)</span> - це похибка моделі.</p>
<p>Для початку вкажемо певні позначення, які далі нам трішки пригодяться:</p>
<p><span class="math inline">\(m\)</span> - кількість об“єктів у вибірці;<br />
<span class="math inline">\(n\)</span> - кількість змінних;<br />
<span class="math inline">\(y\)</span> - цільова змінна;<br />
<span class="math inline">\(\hat{y}\)</span> - прогнозні значення цільової змінної;<br />
<span class="math inline">\(X\)</span> - змінні, за допомогою яких описується цільова змінна (перший стовбець складається із одиниць);<br />
<span class="math inline">\(w\)</span> - коефіцієнти при змінних;<br />
<span class="math inline">\(y_i\)</span> - значення цільової змінної для <span class="math inline">\(i\)</span>-го об”єкту;<br />
<span class="math inline">\(x_i\)</span> - значення змінних для <span class="math inline">\(i\)</span>-го об“єкту;</p>
<p>Запишемо всі наші позначення у матричному вигляді:</p>
<p><span class="math display">\[
y = \begin{bmatrix}
      y_1  \\
      y_2  \\
      \cdots \\
      y_i  \\
      \cdots \\
      y_m
    \end{bmatrix}
,\:\: 
\hat{y} = \begin{bmatrix}
      \hat{y_1}  \\
      \hat{y_2}  \\
      \cdots     \\
      \hat{y_i}  \\
      \cdots     \\
      \hat{y_m}
    \end{bmatrix}
,\:\: 
X = \begin{bmatrix}
      x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1n} \\
      x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2n} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      x_{i1} &amp; x_{i2} &amp; \cdots &amp; x_{in} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      x_{m1} &amp; x_{m2} &amp; \cdots &amp; x_{mn} \\
    \end{bmatrix} = 
    \begin{bmatrix}
      1 &amp; x_{12} &amp; \cdots &amp; x_{1n} \\
      1 &amp; x_{22} &amp; \cdots &amp; x_{2n} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      1 &amp; x_{i2} &amp; \cdots &amp; x_{in} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      1 &amp; x_{m2} &amp; \cdots &amp; x_{mn} \\
    \end{bmatrix}
,\:\:
w = \begin{bmatrix}
      {w_1}  \\
      {w_2}  \\
      \cdots \\
      {w_n}
    \end{bmatrix}
\]</span></p>
<p>Запишемо рівняння лінійної регресії наступним чином:</p>
<p><span class="math display">\[y \approx \hat{y} = Xw\]</span></p>
<p>А тепер розпишемо більш детально, що означає попереднє рівняння, використовуючи правило множення матриць:</p>
<p><span class="math display">\[
y \approx \hat{y} = \begin{bmatrix}
      \hat{y_1}  \\
      \hat{y_2}  \\
      \cdots \\
      \hat{y_i}  \\
      \cdots \\
      \hat{y_m}
    \end{bmatrix}
    =
    \begin{bmatrix}
      x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1n} \\
      x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2n} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      x_{i1} &amp; x_{i2} &amp; \cdots &amp; x_{in} \\
      \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
      x_{m1} &amp; x_{m2} &amp; \cdots &amp; x_{mn} \\
    \end{bmatrix}
    \begin{bmatrix}
      {w_1}  \\
      {w_2}  \\
      \cdots \\
      {w_n}
    \end{bmatrix}
    =
    \begin{bmatrix}
      x_{11}w_1 + x_{12}w_2 + \cdots + x_{1n}w_n \\
      x_{21}w_1 + x_{22}w_2 + \cdots + x_{2n}w_n \\
      \cdots     \cdots     \cdots  \cdots    \\
      x_{i1}w_1 + x_{i2}w_2 + \cdots + x_{in}w_n \\
      \cdots     \cdots     \cdots  \cdots    \\
      x_{m1}w_1 + x_{m2}w_2 + \cdots + x_{mn}w_n \\
    \end{bmatrix}
\]</span></p>
<p>Позначимо через <span class="math inline">\(e_i\)</span> похибку між цільовою змінною та прогнозними значеннями лінійної регресії на <span class="math inline">\(i\)</span>-му об“єкті: <span class="math display">\[e_i = y_i - \hat{y_i}\]</span></p>
<p>Визначимо функцію втрат як суму квадратів похибок між цільовою змінною та прогнозними значеннями на всіх об“єктах вибірки: <span class="math display">\[
J(w) = \frac{1}{2m} \sum_{i = 1}^{m}e_i^2
\]</span></p>
<p>Для зручності запишемо функцію втрат у векторній формі, яка, як показано далі, еквівадентна попередньому виразу: <span class="math display">\[J(w) = \frac{1}{2m} e^{T}e =                                     
  \frac{1}{2m}
  \begin{bmatrix} e_1 &amp; e_2 &amp; \cdots &amp; e_m \end{bmatrix}
  \begin{bmatrix} e_1 \\ e_2 \\ \cdots \\ e_m \end{bmatrix} = \\     
    =\frac{1}{2m} (e_{1}e_{1} + e_{2}e_{2} + \cdots + e_{m}e_{m})   
    =\frac{1}{2m} (e_{1}^2 + e_{2}^2 + \cdots + e_{m}^2)           
    =\frac{1}{2m}\sum_{i = 1}^{m}e_i^2\]</span></p>
<p>Зробимо собі шпаргалку із властивостями матриць (те, що постійно забувається і необхідно весь час гуглити):</p>
<hr />
<p><span class="math inline">\((в1): (A + B)^{T} = A^{T} + B^{T}\)</span><br />
<span class="math inline">\((в2): (AB)^{T} = B^{T}A^{T}\)</span><br />
<span class="math inline">\((в3): (A^{T})^{T} = A\)</span><br />
<span class="math inline">\((в4): a^{T}b = b^{T}a\)</span><br />
<span class="math inline">\((в5): A^{-1}A = I\)</span>, де <span class="math inline">\(I\)</span> - одинична матриця</p>
<hr />
<p>Розпишемо функцію втрат наступним чином:</p>
<p><span class="math display">\[J(w) = \frac{1}{2m} e^{T}e = \frac{1}{2m}(y - \hat{y})^{T}(y - \hat{y}) =\frac{1}{2m}(y - Xw)^{T}(y - Xw) = \\
використаємо \; правило \; (в1) \\
=\frac{1}{2m}(y^{\color{red}T} - (Xw)^{\color{red}T})(y - Xw) = \\
=\frac{1}{2m}(y^{T}y - y^{T}Xw - (Xw)^{T}y + (Xw)^{T}Xw) = \\
використаємо \; правило \; (в4) \\
=\frac{1}{2m}(y^{T}y - \color{red}{2(Xw)^{T}y} + (Xw)^{T}Xw) = \\
використаємо \; правило \; (в2) \\
=\frac{1}{2m}(y^{T}y - 2w^{\color{red}T}X^{\color{red}T}y + w^{\color{red}T}X^{\color{red}T}Xw)\]</span></p>
<p>Отже, функція втрат у матричній формі має наступний вигляд:</p>
<p><span class="math display">\[J(w) = \frac{1}{2m}(y^{T}y - 2w^{T}X^{T}y + w^{T}X^{T}Xw)\]</span></p>
<p>Щоб знайти параметри моделі <span class="math inline">\(w\)</span> необхідно взяти похідку від функції втрат <span class="math inline">\(J(w)\)</span> по вказаним параметрам, прирівняти її до нуля і розв“язати отримане рівняння відносно <span class="math inline">\(w\)</span>.</p>
<p>Зробимо собі ще одну шпаргалку із правилами диференціювання матриць:</p>
<hr />
<p><span class="math inline">\((п1) : \frac{\partial}{\partial a}a^{T}b = b\)</span><br />
<span class="math inline">\((п2) : \frac{\partial}{\partial a}a^{T}Ba = (B + B^{T})a\)</span></p>
<hr />
<p>Вызьмемо похідну від функції втрат по параметрам моделі:</p>
<p><span class="math display">\[
\frac{\partial J(w)}{\partial w} = 
\frac{\partial}{\partial w}[\frac{1}{2m}(y^{T}y - 2w^{T}X^{T}y + w^{T}X^{T}Xw)] = \\
=
\frac{1}{2m}[\frac{\partial}{\partial w}(y^{T}y) - 2\frac{\partial}{\partial w}(w^{T}X^{T}y) + \frac{\partial}{\partial w}(w^{T}X^{T}Xw)]
\]</span></p>
<p>Розглянемо кожну похідну окремо:</p>
<p><span class="math display">\[\frac{\partial}{\partial w}(y^{T}y) = 0\]</span></p>
<p>Згідно правила (п1) маємо (<span class="math inline">\(X^{T}y\)</span> - вектор стовбець):<br />
<span class="math display">\[\frac{\partial}{\partial w}(w^{T}X^{T}y) = X^{T}y\]</span></p>
<p>Згідно правила (п2) маємо (нехай <span class="math inline">\(X^{T}X\)</span> - <span class="math inline">\(B\)</span>):</p>
<p><span class="math display">\[\frac{\partial}{\partial w}(w^{T}X^{T}Xw) = (X^{T}X + (X^{T}X)^{T})w = \\
згідно \; правила \; (в2) \\
= (X^{T}X + X^{\color{red}T}(X^{T})^{\color{red}T})w = \\
згідно \; правила \; (в3) \\
= (X^{T}X + X^{T}X)w = 2X^{T}Xw
\]</span></p>
<p>Отже: <span class="math display">\[\frac{\partial J(w)}{\partial w} = \frac{1}{2m}(0 - 2X^{T}y + 2X^{T}Xw) = \frac{1}{m}(X^{T}Xw - X^{T}y)\]</span></p>
<p>Для тогоб щоб знайти значення <span class="math inline">\(w\)</span>, прирівняємо похідну до нуля:</p>
<p><span class="math display">\[\frac{1}{m}(X^{T}Xw - X^{T}y) = 0\]</span> <span class="math display">\[X^{T}Xw - X^{T}y = 0\]</span></p>
<p><span class="math display">\[X^{T}Xw = X^{T}y\]</span></p>
<p>Використаємо правило (в5) і домножимо ліву і праву частину рівняння на <span class="math inline">\((X^{T}X)^{-1}\)</span>: <span class="math display">\[\color{red}{(X^{T}X)^{-1}}X^{T}Xw = \color{red}{(X^{T}X)^{-1}}X^{T}y\]</span></p>
<p>Звідси маємо значення параметрів моделі:</p>
<p><span class="math display">\[w = (X^{T}X)^{-1}X^{T}y\]</span></p>
</div>
<div id="-" class="section level2">
<h2>Градієнтний спуск</h2>
<p>Оскільки ось це <span class="math inline">\((X^{T}X)^{-1}X^{T}\)</span> рахувати дуже затратно, особливо на великих даних, для отримання параметрів моделі можна використати алгоритм градієнтного спуску. Градієнт функції - це вектор із часткових похідних по її параметрах: <span class="math display">\[\bigtriangledown_{w} J(w) = 
\begin{bmatrix}
  \frac{\partial J(w)}{\partial w_1} \\
  \frac{\partial J(w)}{\partial w_2} \\
  \cdots                             \\
  \frac{\partial J(w)}{\partial w_n}
\end{bmatrix}
\]</span></p>
<p>Нам може допомогти властивість градієнта, яка говорить, що він вказує напрямок, в якому зростає функція. А нам необхідно знайти напрямок, в якому функція зменшується. Для цього поставимо знак мінус перед градієнтом (антиградієнт).</p>
<p>Формула розрахунку параметрів моделі буде мати наступний вигляд:</p>
<p><strong><em>Повторювати:</em></strong> <span class="math display">\[w_{t} = w_{t-1} - \alpha \bigtriangledown_{w} J(w)\]</span> <strong><em>Поки не зійдеться</em></strong><br />
де <span class="math inline">\(t\)</span> номер ітерації алгоритму, <span class="math inline">\(\alpha\)</span> - “швидкість” навчання.</p>
<p>Розпишемо формулу:</p>
<p><span class="math display">\[w_{t} = w_{t-1} - \alpha  \frac{\partial J(w)}{\partial w}\]</span></p>
<p>Похідну функції втрат по параметрах ми вже рахували вище:</p>
<p><span class="math display">\[w_{t} = w_{t-1} - \alpha \frac{1}{m}(X^{T}Xw - X^{T}y)\]</span></p>
<p>Винесемо <span class="math inline">\(X^{T}\)</span>за дужки:</p>
<p><span class="math display">\[w_{t} = w_{t-1} - \alpha \frac{1}{m}(X^{T}(Xw - y))\]</span></p>
</div>
<div id="--" class="section level2">
<h2>Всякі різні експерименти</h2>
<p>Перейдемо до більш цікавого і спробуємо трішки попрацювати із формулами, які описувались вище, і даними.</p>
<pre class="r"><code># завантажимо бібліотеки, які нам пригодяться
library(dplyr)           # для маніпуляції із даними
library(tidyr)           # для маніпуляції із даними
library(tibble)          # для маніпуляції із даними
library(purrr)           # для функціонального програмування
library(ggplot2)         # для гарних графіків
library(AmesHousing)     # тут лежать дані, які ми будемо використовувати
library(recipes)         # для всяких перетворень над даними
library(gganimate)       # для анімацій
library(broom)           # для акуратної роботи із вихідними результатами моделей
library(gt)              # для гарних табличок</code></pre>
<p>Завантажимо дані по цінах на квартири:</p>
<pre class="r"><code>df &lt;- AmesHousing::make_ames() %&gt;% 
  as_tibble()

# df</code></pre>
<p>Для подальшої роботи використаємо як цільову змінну <strong>Sale_Price</strong>, а як залежну - <strong>Lot_Area</strong>. Для зручності перейменуємо їх як <em>target</em> = <em>Sale_Price</em>, <em>area</em> = <em>Lot_Area</em> і прологарифмуємо їх, щоб лінійна залежність між змінними була більш виражена:</p>
<pre class="r"><code>df_model &lt;- 
  df %&gt;% 
  select(target = Sale_Price, area = Lot_Area) %&gt;% 
  mutate_all(log)

# df_model</code></pre>
<p>Подивимось на залежність ціни квартили від площі:</p>
<pre class="r"><code>p &lt;- 
  ggplot(df_model, aes(x = area, y = target)) +
  geom_point(alpha = 0.25, col = &quot;steelblue&quot;, size = 2) +
  geom_smooth(se = FALSE, method = &quot;lm&quot;, formula = y ~ x, col = &quot;red4&quot;) + 
  theme_minimal() +
  theme(panel.grid = element_blank())

p</code></pre>
<p><img src="/post/2019-01-13-_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Зробимо певні перетворення над змінною <em>area</em>: створимо <em>“рецепт”</em> (можна було б і більш простішим способом це зробити), щоб змінна мала більш стабільний розкид даних.</p>
<pre class="r"><code># створюємо рецепт
rec &lt;- 
  recipe(
    target ~ area, 
    data = df_model
  ) %&gt;% 
  step_center(area) %&gt;%    # відняти середнє
  step_scale(area) %&gt;%     # поділити на середньоквадратичне відхилення
  prep(retain = TRUE)

# отримуємо перетворені дані із рецепту
df_model &lt;- juice(rec)

df_model</code></pre>
<pre><code>## # A tibble: 2,930 x 2
##      area target
##     &lt;dbl&gt;  &lt;dbl&gt;
##  1  2.49    12.3
##  2  0.525   11.6
##  3  0.926   12.1
##  4  0.446   12.4
##  5  0.865   12.2
##  6  0.227   12.2
##  7 -1.16    12.3
##  8 -1.12    12.2
##  9 -0.978   12.4
## 10 -0.332   12.1
## # ... with 2,920 more rows</code></pre>
<p>Сформуємо вектор цільової змінної <span class="math inline">\(y\)</span> і матрицю змінних <span class="math inline">\(X\)</span>, не забувши, звісно, додати стовбець із одиниць:</p>
<pre class="r"><code>Y &lt;- 
  df_model %&gt;% 
  select(target) %&gt;% 
  as.matrix()

dim(Y); head(Y)</code></pre>
<pre><code>## [1] 2930    1</code></pre>
<pre><code>##        target
## [1,] 12.27839
## [2,] 11.56172
## [3,] 12.05525
## [4,] 12.40492
## [5,] 12.15425
## [6,] 12.18332</code></pre>
<pre class="r"><code>X &lt;-
  df_model %&gt;% 
  select(area) %&gt;% 
  add_column(intercept = 1, .before = &quot;area&quot;) %&gt;% 
  as.matrix()

dim(X); head(X)</code></pre>
<pre><code>## [1] 2930    2</code></pre>
<pre><code>##      intercept      area
## [1,]         1 2.4926105
## [2,]         1 0.5251899
## [3,]         1 0.9263526
## [4,]         1 0.4458299
## [5,]         1 0.8654902
## [6,]         1 0.2268022</code></pre>
<p>Створимо модель лінійної регресії стандартними засобами за допомогою функції <em>lm()</em> та подивимось на її коефіцієнти:</p>
<pre class="r"><code>model_lm &lt;- lm(target ~ area, data = df_model)

broom::tidy(model_lm) %&gt;% 
  select(term, estimate) %&gt;% 
  gt::gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dolzpjzqgw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#dolzpjzqgw .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#dolzpjzqgw .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dolzpjzqgw .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dolzpjzqgw .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#dolzpjzqgw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#dolzpjzqgw .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#dolzpjzqgw .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#dolzpjzqgw .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#dolzpjzqgw .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#dolzpjzqgw .gt_striped {
  background-color: #f2f2f2;
}

#dolzpjzqgw .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#dolzpjzqgw .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#dolzpjzqgw .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#dolzpjzqgw .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#dolzpjzqgw .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#dolzpjzqgw .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#dolzpjzqgw .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#dolzpjzqgw .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#dolzpjzqgw .gt_center {
  text-align: center;
}

#dolzpjzqgw .gt_left {
  text-align: left;
}

#dolzpjzqgw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dolzpjzqgw .gt_font_normal {
  font-weight: normal;
}

#dolzpjzqgw .gt_font_bold {
  font-weight: bold;
}

#dolzpjzqgw .gt_font_italic {
  font-style: italic;
}

#dolzpjzqgw .gt_super {
  font-size: 65%;
}

#dolzpjzqgw .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="dolzpjzqgw" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>term</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>estimate</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>(Intercept)</td>
<td class='gt_row gt_right'>12.0209687</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>area</td>
<td class='gt_row gt_right gt_striped'>0.1501933</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Тепер отримаємо коефіцієнти лінійної регресії за допомогою раніше виведеної формули <span class="math inline">\(w = (X^{T}X)^{-1}X^{T}y\)</span>:</p>
<pre class="r"><code># напишемо функцію отримання w
get_linear_coef &lt;- 
  function(
    x,   # матриця змінних
    y    # вектор цільової змінної
  ) {
    
    # solve() - отримати обернену матрицю
    # t()     - отримати транспоновану матрицю

    result &lt;- solve(t(x) %*% x) %*% t(X) %*% y
    
    colnames(result) &lt;- NULL
    return(result)
  }

# запускаємо функцію і бачимо, що ніби все зійшлося
coef &lt;- get_linear_coef(x = X, y = Y)

coef %&gt;% 
  as.data.frame() %&gt;% 
  rownames_to_column(var = &quot;term&quot;) %&gt;% 
  rename(estimate = V1) %&gt;% 
  gt::gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#quazqegwqr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#quazqegwqr .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#quazqegwqr .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#quazqegwqr .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#quazqegwqr .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#quazqegwqr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#quazqegwqr .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#quazqegwqr .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#quazqegwqr .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#quazqegwqr .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#quazqegwqr .gt_striped {
  background-color: #f2f2f2;
}

#quazqegwqr .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#quazqegwqr .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#quazqegwqr .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#quazqegwqr .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#quazqegwqr .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#quazqegwqr .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#quazqegwqr .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#quazqegwqr .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#quazqegwqr .gt_center {
  text-align: center;
}

#quazqegwqr .gt_left {
  text-align: left;
}

#quazqegwqr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#quazqegwqr .gt_font_normal {
  font-weight: normal;
}

#quazqegwqr .gt_font_bold {
  font-weight: bold;
}

#quazqegwqr .gt_font_italic {
  font-style: italic;
}

#quazqegwqr .gt_super {
  font-size: 65%;
}

#quazqegwqr .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="quazqegwqr" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_left' rowspan='1' colspan='1'>term</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>estimate</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_left'>intercept</td>
<td class='gt_row gt_right'>12.0209687</td>
</tr>
<tr>
<td class='gt_row gt_left gt_striped'>area</td>
<td class='gt_row gt_right gt_striped'>0.1501933</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Напишемо функцію для отримання прогнозних значень <span class="math inline">\(\hat{y}\)</span>;</p>
<pre class="r"><code>get_linear_pred &lt;-
  function(
    x,
    coef
  ) {
    
    result &lt;- x %*% coef
    
    return(result)
    
  }</code></pre>
<p>Зробимо прогноз значень за допомогою стандартної моделі і отриманих коефіцієнтів:</p>
<pre class="r"><code>bind_cols(
  tibble(&#39;Стандартна модель&#39; = predict(model_lm, df_model)),
  get_linear_pred(x = X, coef = coef) %&gt;% 
  as_tibble() %&gt;% 
  rename(&#39;По формулі&#39; = V1)
) %&gt;% 
    slice(1:5) %&gt;% 
    gt::gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ggdpvdfuic .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#ggdpvdfuic .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#ggdpvdfuic .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ggdpvdfuic .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ggdpvdfuic .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#ggdpvdfuic .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#ggdpvdfuic .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#ggdpvdfuic .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#ggdpvdfuic .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ggdpvdfuic .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ggdpvdfuic .gt_striped {
  background-color: #f2f2f2;
}

#ggdpvdfuic .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#ggdpvdfuic .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#ggdpvdfuic .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#ggdpvdfuic .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#ggdpvdfuic .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#ggdpvdfuic .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#ggdpvdfuic .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#ggdpvdfuic .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#ggdpvdfuic .gt_center {
  text-align: center;
}

#ggdpvdfuic .gt_left {
  text-align: left;
}

#ggdpvdfuic .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ggdpvdfuic .gt_font_normal {
  font-weight: normal;
}

#ggdpvdfuic .gt_font_bold {
  font-weight: bold;
}

#ggdpvdfuic .gt_font_italic {
  font-style: italic;
}

#ggdpvdfuic .gt_super {
  font-size: 65%;
}

#ggdpvdfuic .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ggdpvdfuic" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>Стандартна модель</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>По формулі</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>12.39534</td>
<td class='gt_row gt_right'>12.39534</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>12.09985</td>
<td class='gt_row gt_right gt_striped'>12.09985</td>
</tr>
<tr>
<td class='gt_row gt_right'>12.16010</td>
<td class='gt_row gt_right'>12.16010</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>12.08793</td>
<td class='gt_row gt_right gt_striped'>12.08793</td>
</tr>
<tr>
<td class='gt_row gt_right'>12.15096</td>
<td class='gt_row gt_right'>12.15096</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Як показано, ніби сходиться.</p>
<p>Перейдемо до градієнтного спуску.</p>
<p>Напишемо функцію для обчислення функції втрат <span class="math inline">\(J(w) = \frac{1}{2m} e^{T}e\)</span>:</p>
<pre class="r"><code>cost_func &lt;- 
  function(
    x,     # матриця із значеннями змінних
    y,     # вектор стовбець цільової змінної
    coef   # вектор стовбець коефіцієнтів моделі
  ) {
    m &lt;- nrow(x)
    e &lt;- y - x %*% coef
    result &lt;- (1 / (2 * m)) * (t(e) %*% e)
    
    return(result)
  }</code></pre>
<p>Напишемо функцію для обчислення градієнта функції втрат по параметрах моделі <span class="math inline">\(\bigtriangledown_{w}J(w) = \frac{1}{m}(X^{T}(Xw - y))\)</span></p>
<pre class="r"><code>gradient &lt;- 
  function(
    x,
    y,
    coef
  ) {
    m &lt;- nrow(x)
    result &lt;- (1 / m) * (t(x) %*% (x %*% coef - y))
    
    return(result)
  }</code></pre>
<p>Нарешті, напишемо функцію для обчислення коефіцієнтів моделі градієнтним спуском:</p>
<pre class="r"><code>get_linear_coef_grad &lt;- 
  function(
    x,
    y,
    coef,
    count_iter = 100,
    alpha = 0.1
  ) {
    # створимо пусті списки, куди будемо записувати параметри і значення функції втрат
    coef_list &lt;- vector(mode = &quot;list&quot;, length = count_iter)
    cost_list &lt;- vector(mode = &quot;list&quot;, length = count_iter)

    # починає іти по ітераціях
    for (iter in 1:count_iter) {
      # оновлюємо параметри моделі
      coef &lt;- coef - alpha * gradient(x = x, y = y, coef = coef)
      # обчислюємо функцію втрат для оновлених параметрів моделі
      cost &lt;- cost_func(x = x, y = y, coef = coef)
      # збережемо все
      coef_list[[iter]] &lt;- coef
      cost_list[[iter]] &lt;- cost

    }
    # зробимо із списку дата фрейм
    cost_list &lt;- map_dfr(
      .x = cost_list,
      .f = ~tibble(cost = .x)
    )
    # зробимо із списку дата фрейм
    coef_list &lt;- map_dfr(
      .x = coef_list,
      .f = ~{
        .x %&gt;% t() %&gt;% as_tibble()
      }
    ) %&gt;% 
      rename_all(funs(paste0(&quot;w_&quot;, 1:nrow(coef))))
    # буде повертатись табличка із значеннями функції втрат і значеннями параметрів моделі на кожній ітерації
    result &lt;- bind_cols(
      tibble(iteration = 1:count_iter),
      cost_list,
      coef_list
    )
    
    return(result)
  }</code></pre>
<p>Отже, маючи всі необхідні інструменти прогонимо градієнтний спуск.</p>
<p>Спочатку ініціалізуємо параметри моделі:</p>
<pre class="r"><code>w &lt;- matrix(data = -20, nrow = 2, ncol = 1)
w</code></pre>
<pre><code>##      [,1]
## [1,]  -20
## [2,]  -20</code></pre>
<p>Запустимо градієнтний спуск на 100-а ітераціях із швидкістю навчання 0.1:</p>
<pre class="r"><code>iter_for_model &lt;- 100
learning_rate &lt;- 0.1

coef_grad &lt;- get_linear_coef_grad(
  x = X,
  y = Y,
  coef = w,
  count_iter = iter_for_model,
  alpha = learning_rate
)
coef_grad</code></pre>
<pre><code>## # A tibble: 100 x 4
##    iteration  cost     w_1    w_2
##        &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1         1 580.  -16.8   -18.0 
##  2         2 470.  -13.9   -16.2 
##  3         3 380.  -11.3   -14.5 
##  4         4 308.   -8.99  -13.1 
##  5         5 250.   -6.89  -11.8 
##  6         6 202.   -5.00  -10.6 
##  7         7 164.   -3.29   -9.49
##  8         8 133.   -1.76   -8.53
##  9         9 108.   -0.385  -7.66
## 10        10  87.1   0.856  -6.88
## # ... with 90 more rows</code></pre>
<p>Відразу подивимось на коефіцієнти моделі на останній ітерації:</p>
<pre class="r"><code>coef_grad %&gt;% 
  filter(iteration == iter_for_model) %&gt;% 
  select(starts_with(&quot;w_&quot;)) %&gt;% 
  gt::gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ktzvtxmqze .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#ktzvtxmqze .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#ktzvtxmqze .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ktzvtxmqze .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ktzvtxmqze .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#ktzvtxmqze .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#ktzvtxmqze .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#ktzvtxmqze .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#ktzvtxmqze .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ktzvtxmqze .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#ktzvtxmqze .gt_striped {
  background-color: #f2f2f2;
}

#ktzvtxmqze .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#ktzvtxmqze .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#ktzvtxmqze .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#ktzvtxmqze .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#ktzvtxmqze .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#ktzvtxmqze .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#ktzvtxmqze .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#ktzvtxmqze .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#ktzvtxmqze .gt_center {
  text-align: center;
}

#ktzvtxmqze .gt_left {
  text-align: left;
}

#ktzvtxmqze .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ktzvtxmqze .gt_font_normal {
  font-weight: normal;
}

#ktzvtxmqze .gt_font_bold {
  font-weight: bold;
}

#ktzvtxmqze .gt_font_italic {
  font-style: italic;
}

#ktzvtxmqze .gt_super {
  font-size: 65%;
}

#ktzvtxmqze .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ktzvtxmqze" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>w_1</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>w_2</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>12.02012</td>
<td class='gt_row gt_right'>0.1496561</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Здається отримали щось схоже на попередні значення.</p>
<p>Подивимось на графік зміни функції втрат в залежності від ітерації:</p>
<pre class="r"><code>plot_cost &lt;- coef_grad %&gt;% 
  ggplot(aes(x = iteration, y = cost, col = cost)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_color_distiller(palette = &quot;Spectral&quot;) +
  theme_minimal() +
  theme(panel.grid = element_blank())

plot_cost</code></pre>
<p><img src="/post/2019-01-13-_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Можна також подивитись як “рухались” параметри моделі до мінімуму функції втрат.</p>
<p>Створимо спочатку сітку із параметрів, для яких обчислимо функцію втрат:</p>
<pre class="r"><code>coef_grid &lt;- 
  expand.grid(
    w_1 = seq(-25, 25, length.out = 100), 
    w_2 = seq(-25, 25, length.out = 100)
  )%&gt;% 
  as_tibble() %&gt;% 
  mutate(rownumb = row_number()) %&gt;% 
  group_by(rownumb) %&gt;% 
  nest() %&gt;% 
  mutate(
    cost = map(
      .x = data,
      .f = ~{
        coef &lt;- matrix(c(.x$w_1, .x$w_2), nrow = 2, ncol = 1)
        cost_func(x = X, y = Y, coef = coef)
      }
    )
  ) %&gt;% 
  unnest()
coef_grid %&gt;% 
  slice(1:5) %&gt;% 
  gt::gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#owxkxqczkw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #000000;
  font-size: 16px;
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
}

#owxkxqczkw .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
}

#owxkxqczkw .gt_title {
  color: #000000;
  font-size: 125%;
  /* heading.title.font.size */
  padding-top: 4px;
  /* heading.top.padding */
  padding-bottom: 1px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#owxkxqczkw .gt_subtitle {
  color: #000000;
  font-size: 85%;
  /* heading.subtitle.font.size */
  padding-top: 1px;
  padding-bottom: 4px;
  /* heading.bottom.padding */
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#owxkxqczkw .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* heading.border.bottom.color */
}

#owxkxqczkw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  padding-top: 4px;
  padding-bottom: 4px;
}

#owxkxqczkw .gt_col_heading {
  color: #000000;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 16px;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  vertical-align: middle;
  padding: 10px;
  margin: 10px;
}

#owxkxqczkw .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#owxkxqczkw .gt_group_heading {
  padding: 8px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#owxkxqczkw .gt_empty_group_heading {
  padding: 0.5px;
  color: #000000;
  background-color: #FFFFFF;
  /* stub_group.background.color */
  font-size: 16px;
  /* stub_group.font.size */
  font-weight: initial;
  /* stub_group.font.weight */
  border-top-style: solid;
  /* stub_group.border.top.style */
  border-top-width: 2px;
  /* stub_group.border.top.width */
  border-top-color: #A8A8A8;
  /* stub_group.border.top.color */
  border-bottom-style: solid;
  /* stub_group.border.bottom.style */
  border-bottom-width: 2px;
  /* stub_group.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* stub_group.border.bottom.color */
  vertical-align: middle;
}

#owxkxqczkw .gt_striped {
  background-color: #f2f2f2;
}

#owxkxqczkw .gt_row {
  padding: 10px;
  /* row.padding */
  margin: 10px;
  vertical-align: middle;
}

#owxkxqczkw .gt_stub {
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #A8A8A8;
  padding-left: 12px;
}

#owxkxqczkw .gt_stub.gt_row {
  background-color: #FFFFFF;
}

#owxkxqczkw .gt_summary_row {
  background-color: #FFFFFF;
  /* summary_row.background.color */
  padding: 6px;
  /* summary_row.padding */
  text-transform: inherit;
  /* summary_row.text_transform */
}

#owxkxqczkw .gt_first_summary_row {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
}

#owxkxqczkw .gt_table_body {
  border-top-style: solid;
  /* field.border.top.style */
  border-top-width: 2px;
  /* field.border.top.width */
  border-top-color: #A8A8A8;
  /* field.border.top.color */
  border-bottom-style: solid;
  /* field.border.bottom.style */
  border-bottom-width: 2px;
  /* field.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* field.border.bottom.color */
}

#owxkxqczkw .gt_footnote {
  font-size: 90%;
  /* footnote.font.size */
  padding: 4px;
  /* footnote.padding */
}

#owxkxqczkw .gt_sourcenote {
  font-size: 90%;
  /* sourcenote.font.size */
  padding: 4px;
  /* sourcenote.padding */
}

#owxkxqczkw .gt_center {
  text-align: center;
}

#owxkxqczkw .gt_left {
  text-align: left;
}

#owxkxqczkw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#owxkxqczkw .gt_font_normal {
  font-weight: normal;
}

#owxkxqczkw .gt_font_bold {
  font-weight: bold;
}

#owxkxqczkw .gt_font_italic {
  font-style: italic;
}

#owxkxqczkw .gt_super {
  font-size: 65%;
}

#owxkxqczkw .gt_footnote_glyph {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="owxkxqczkw" style="overflow-x:auto;"><!--gt table start-->
<table class='gt_table'>
<tr>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>rownumb</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>cost</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>w_1</th>
<th class='gt_col_heading gt_right' rowspan='1' colspan='1'>w_2</th>
</tr>
<tbody class='gt_table_body'>
<tr>
<td class='gt_row gt_right'>1</td>
<td class='gt_row gt_right'>1001.5060</td>
<td class='gt_row gt_right'>-25.00000</td>
<td class='gt_row gt_right'>-25</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>2</td>
<td class='gt_row gt_right gt_striped'>982.9361</td>
<td class='gt_row gt_right gt_striped'>-24.49495</td>
<td class='gt_row gt_right gt_striped'>-25</td>
</tr>
<tr>
<td class='gt_row gt_right'>3</td>
<td class='gt_row gt_right'>964.6212</td>
<td class='gt_row gt_right'>-23.98990</td>
<td class='gt_row gt_right'>-25</td>
</tr>
<tr>
<td class='gt_row gt_right gt_striped'>4</td>
<td class='gt_row gt_right gt_striped'>946.5615</td>
<td class='gt_row gt_right gt_striped'>-23.48485</td>
<td class='gt_row gt_right gt_striped'>-25</td>
</tr>
<tr>
<td class='gt_row gt_right'>5</td>
<td class='gt_row gt_right'>928.7568</td>
<td class='gt_row gt_right'>-22.97980</td>
<td class='gt_row gt_right'>-25</td>
</tr>
</tbody>
</table>
<!--gt table end-->
</div>
<p>Тепер побудуємо графік руху коефіцієнтів до мінімуму функції втрат:</p>
<pre class="r"><code>plot_cost_coef &lt;- 
  ggplot() + 
  geom_contour(
    data = coef_grid,
    aes(x = w_1, y = w_2, z = cost, colour = ..level..)
  ) + 
  geom_point(
    data = coef_grad,
    aes(x = w_1, y = w_2, colour = cost),
    size = 2, alpha = 0.7
  ) +
  scale_color_distiller(palette = &quot;Spectral&quot;) +
  theme_minimal() +
  theme(panel.grid = element_blank())

plot_cost_coef</code></pre>
<p><img src="/post/2019-01-13-_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Ось так ми і добрались до мінімуму функції втрат :)</p>
<p>Подивимось як змінювалась лінія регресії по ітераціях</p>
<pre class="r"><code># зробимо прогнози для параметрів моделі 
coef_grad_pred &lt;- coef_grad %&gt;% 
  filter(iteration %in% seq(20, 100, 5))%&gt;% 
  select(iteration, w_1, w_2) %&gt;% 
  group_by(iteration) %&gt;% 
  nest() %&gt;% 
  mutate(
    pred = map(
      .x = data,
      .f = ~{
        coef &lt;- matrix(c(.x$w_1, .x$w_2), nrow = 2, ncol = 1)
        tibble(pred = as.vector(X %*% coef))
      }
    )
  ) %&gt;% 
  select(iteration, pred) %&gt;% 
  unnest()

# додамо реальні значення цільової змінної та предиктора
coef_grad_pred$target &lt;- df_model$target
coef_grad_pred$area &lt;- df_model$area
# glimpse(coef_grad_pred)

coef_grad_pred %&gt;% 
  ggplot() + 
  geom_point(aes(x = area, y = target), alpha=  0.2) +
  geom_line(aes(x = area, y = pred), col = &quot;red4&quot;, size = 0.5) +
  geom_smooth(aes(x = area, y = target), method = &quot;lm&quot;, se = F, size = 0.5, col = &quot;blue4&quot;) +
  scale_x_continuous(limits = c(-4, 7)) + 
  scale_y_continuous(limits = c(9, 14)) + 
  theme_minimal() +
  theme(panel.grid = element_blank()) +
  gganimate::transition_states(states = iteration) +
  ggtitle(&quot;Ітерація --&gt; {closest_state}&quot;)</code></pre>
<p><img src="/post/2019-01-13-_files/figure-html/unnamed-chunk-21-1.gif" /><!-- --></p>
<p>А можна ще подивитись як впливає швидкість навчання на функцію втрат:</p>
<pre class="r"><code># задамо сітку швидкості навчання і обчислимо параметри моделі
learning_rate_grid &lt;- map_dfr(
  .x = c(0.1, 0.05, 0.01),
  .f = ~{
    get_linear_coef_grad(
      x = X,
      y = Y,
      coef = w,
      count_iter = iter_for_model,
      alpha = .x   # тут будуть змінюватись значення
    ) %&gt;% 
      mutate(learning_rate = .x)
  }
)

# намалюєио гарний графік
plot_alpha &lt;- 
  ggplot(
    data = learning_rate_grid, 
    aes(x = iteration, y = cost, color = factor(learning_rate))
  ) +
  geom_line(size = 1) +
  scale_color_manual(values = c(&quot;red4&quot;, &quot;green4&quot;, &quot;blue4&quot;)) +
  labs(color = &quot;learning_rate&quot;) +
  theme_minimal() +
  theme(panel.grid = element_blank())

plot_alpha</code></pre>
<p><img src="/post/2019-01-13-_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Як видно, чим менша швидкість, тим повільніше навчаємось.</p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

